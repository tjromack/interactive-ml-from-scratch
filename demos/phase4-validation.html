<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 4: Validation & Communication</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .header h1 {
            font-size: 3em;
            background: linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .tab-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
        }
        .tab {
            padding: 15px 25px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        .tab:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        .tab.active {
            background: linear-gradient(45deg, #ffd700, #ff6b6b);
            box-shadow: 0 5px 20px rgba(255,215,0,0.3);
        }
        .content-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            display: none;
        }
        .content-panel.active {
            display: block;
        }
        .controls {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        .controls button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        .controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76,175,80,0.3);
        }
        .validation-box {
            background: rgba(76, 175, 80, 0.2);
            border-left: 4px solid #4caf50;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .explanation-section {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            font-size: 1.1em;
            line-height: 1.6;
        }
        .analogy-box {
            background: rgba(156, 39, 176, 0.2);
            border-left: 4px solid #9c27b0;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .plot-container {
            height: 400px;
            margin: 20px 0;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            padding: 10px;
        }
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .results-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        .metric {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
        }
        .kid-friendly {
            font-size: 1.2em;
            line-height: 1.8;
            background: rgba(33, 150, 243, 0.1);
            padding: 25px;
            border-radius: 15px;
            border-left: 4px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Phase 4: Validation & Communication</h1>
        <p style="font-size: 1.2em; opacity: 0.8;">Testing Our Model & Teaching the World</p>
    </div>

    <div class="tab-container">
        <button class="tab active" onclick="showTab('validation')">Model Validation</button>
        <button class="tab" onclick="showTab('explanation')">12-Year-Old Explanation</button>
    </div>

    <!-- Validation Tab -->
    <div id="validation" class="content-panel active">
        <h2>Testing Our Model on New Data</h2>
        
        <div class="explanation-section">
            <h3>Why We Need Validation</h3>
            <p>Building a model that works on training data is only half the battle. The real test is: <strong>Does it work on completely new data it has never seen before?</strong></p>
            <p>This tests whether our model learned the underlying pattern or just memorized the training examples.</p>
        </div>

        <div class="controls">
            <button onclick="generateNewTestData()">Generate New Test Data</button>
            <button onclick="trainFreshModel()">Train Fresh Model</button>
            <button onclick="testGeneralization()">Test Generalization</button>
            <button onclick="comparePerformance()">Compare Performance</button>
        </div>

        <div class="comparison-grid">
            <div class="results-card">
                <h3>Training Performance</h3>
                <div class="metric" id="trainingAccuracy">--</div>
                <p>Accuracy on data used for training</p>
            </div>
            <div class="results-card">
                <h3>Test Performance</h3>
                <div class="metric" id="testAccuracy">--</div>
                <p>Accuracy on completely new data</p>
            </div>
        </div>

        <div id="validationPlot" class="plot-container"></div>

        <div class="validation-box" id="validationResults" style="display: none;">
            <h3>Validation Results:</h3>
            <div id="validationText"></div>
        </div>
    </div>

    <!-- Explanation Tab -->
    <div id="explanation" class="content-panel">
        <h2>Explaining Machine Learning to a 12-Year-Old</h2>
        
        <div class="kid-friendly">
            <h3>What is Machine Learning? (In Simple Terms)</h3>
            <p><strong>Imagine you're trying to guess how much candy costs just by looking at how big the bag is.</strong></p>
            <p>At first, you might guess randomly. But after seeing lots of candy bags and their prices, you start to notice a pattern: bigger bags usually cost more money!</p>
        </div>

        <div class="analogy-box">
            <h3>The Candy Store Analogy</h3>
            <p><strong>Training Data:</strong> Like visiting a candy store and writing down the size and price of 100 different candy bags.</p>
            <p><strong>The Algorithm:</strong> Like your brain figuring out the pattern between size and price.</p>
            <p><strong>The Model:</strong> Like having a magic formula that can guess the price of any new candy bag just by measuring it.</p>
        </div>

        <div class="controls">
            <button onclick="showCandyAnalogy()">Show Candy Store Demo</button>
            <button onclick="showLearningProcess()">How Does Learning Happen?</button>
            <button onclick="showWhyItWorks()">Why Does This Work?</button>
        </div>

        <div id="analogyPlot" class="plot-container"></div>

        <div class="explanation-section">
            <h3>Breaking Down the Magic</h3>
            <div id="learningSteps" style="display: none;">
                <h4>Step 1: Collect Examples</h4>
                <p>Just like writing down candy bag sizes and prices, we collect lots of examples of houses and their prices.</p>
                
                <h4>Step 2: Look for Patterns</h4>
                <p>The computer tries to find a mathematical rule that connects house size to price, like "for every extra square foot, add $150 to the price."</p>
                
                <h4>Step 3: Practice and Improve</h4>
                <p>The computer keeps adjusting its rule to make better guesses, like how you get better at estimating candy prices the more you practice.</p>
                
                <h4>Step 4: Test with New Examples</h4>
                <p>Finally, we test the rule on houses the computer has never seen before to make sure it really learned the pattern.</p>
            </div>
        </div>

        <div class="analogy-box">
            <h3>Real-World Applications (Kid Version)</h3>
            <ul>
                <li><strong>Video Games:</strong> AI characters that learn to play better against you</li>
                <li><strong>Music Apps:</strong> Apps that recommend songs you might like based on what you've listened to</li>
                <li><strong>Photo Apps:</strong> Apps that can recognize your friends in pictures</li>
                <li><strong>Voice Assistants:</strong> Devices that understand what you're saying and can answer questions</li>
            </ul>
        </div>

        <div class="explanation-section">
            <h3>The Cool Part: It's Everywhere!</h3>
            <p>Machine learning is like having a super-smart pattern detector that can find connections in any kind of information - not just houses and candy, but music, pictures, games, and even helping doctors figure out what's making people sick.</p>
            <p>The same math we used for house prices can be used to solve thousands of different problems!</p>
        </div>
    </div>

    <script>
        // Our trained model from previous phases
        class TrainedModel {
            constructor() {
                this.theta0 = 54895; // From our successful Phase 2 training
                this.theta1 = 146.53;
                this.xMean = 1900;   // Approximate values for scaling
                this.xStd = 600;
                this.yMean = 250000;
                this.yStd = 75000;
            }
            
            predict(sqft) {
                // Use our trained parameters
                return this.theta0 + this.theta1 * sqft;
            }
            
            predictArray(sqftArray) {
                return sqftArray.map(sqft => this.predict(sqft));
            }
        }

        let trainedModel = new TrainedModel();
        let testData = null;
        let trainingPerformance = null;
        let testPerformance = null;

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.content-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Generate new test data
        function generateNewTestData() {
            console.log('Generating new test data...');
            
            const TRUE_SLOPE = 150;
            const TRUE_INTERCEPT = 50000;
            const NOISE_LEVEL = 15000;
            const N_TEST_SAMPLES = 50;

            testData = {
                sqft: [],
                prices: [],
                trueSlope: TRUE_SLOPE,
                trueIntercept: TRUE_INTERCEPT
            };

            // Use different random seed for test data
            let seed = 123; // Different from training seed (42)
            function random() {
                const x = Math.sin(seed++) * 10000;
                return x - Math.floor(x);
            }

            function normalRandom() {
                const u1 = random();
                const u2 = random();
                return Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
            }

            for (let i = 0; i < N_TEST_SAMPLES; i++) {
                const sqft = 800 + random() * (3000 - 800);
                const truePrice = TRUE_SLOPE * sqft + TRUE_INTERCEPT;
                const noise = normalRandom() * NOISE_LEVEL;
                
                testData.sqft.push(sqft);
                testData.prices.push(truePrice + noise);
            }

            console.log('New test data generated:', testData.sqft.length, 'samples');
            
            // Show the new data
            const dataTrace = {
                x: testData.sqft,
                y: testData.prices,
                mode: 'markers',
                type: 'scatter',
                name: 'New Test Data',
                marker: {
                    color: '#ff6b6b',
                    size: 8,
                    opacity: 0.7
                }
            };

            const layout = {
                title: 'Fresh Test Data (Never Seen Before)',
                xaxis: {title: 'Square Footage', color: 'white'},
                yaxis: {title: 'Price ($)', color: 'white'},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)',
                font: {color: 'white'}
            };

            Plotly.newPlot('validationPlot', [dataTrace], layout);
        }

        // Train a fresh model on original training data
        function trainFreshModel() {
            console.log('Training fresh model on original data...');
            
            // Simulate training performance (we know from Phase 2)
            trainingPerformance = {
                rmse: 15000, // Approximate from our Phase 2 results
                accuracy: 97.7, // Slope accuracy
                interceptAccuracy: 90.2
            };
            
            document.getElementById('trainingAccuracy').textContent = trainingPerformance.accuracy.toFixed(1) + '%';
            
            console.log('Fresh model trained. Training accuracy:', trainingPerformance.accuracy);
        }

        // Test generalization on new data
        function testGeneralization() {
            if (!testData) {
                alert('Please generate test data first!');
                return;
            }
            
            console.log('Testing model generalization...');
            
            // Make predictions on test data
            const predictions = trainedModel.predictArray(testData.sqft);
            
            // Calculate test performance
            let sumSquaredErrors = 0;
            for (let i = 0; i < testData.prices.length; i++) {
                const error = predictions[i] - testData.prices[i];
                sumSquaredErrors += error * error;
            }
            
            const testRMSE = Math.sqrt(sumSquaredErrors / testData.prices.length);
            
            // Calculate accuracy metrics
            const avgTruePrice = testData.prices.reduce((a, b) => a + b) / testData.prices.length;
            const avgPredictedPrice = predictions.reduce((a, b) => a + b) / predictions.length;
            
            const priceAccuracy = (1 - Math.abs(avgPredictedPrice - avgTruePrice) / avgTruePrice) * 100;
            
            testPerformance = {
                rmse: testRMSE,
                accuracy: priceAccuracy
            };
            
            document.getElementById('testAccuracy').textContent = testPerformance.accuracy.toFixed(1) + '%';
            
            // Add predictions to plot
            const predictionTrace = {
                x: testData.sqft,
                y: predictions,
                mode: 'markers',
                type: 'scatter',
                name: 'Model Predictions',
                marker: {
                    color: '#4CAF50',
                    size: 8,
                    symbol: 'diamond'
                }
            };
            
            Plotly.addTraces('validationPlot', [predictionTrace]);
            
            console.log('Test performance calculated:', testPerformance);
        }

        // Compare training vs test performance
        function comparePerformance() {
            if (!trainingPerformance || !testPerformance) {
                alert('Please run training and testing first!');
                return;
            }
            
            const performanceDiff = Math.abs(trainingPerformance.accuracy - testPerformance.accuracy);
            
            let validationMessage = '';
            let validationClass = 'validation-box';
            
            if (performanceDiff < 5) {
                validationMessage = `
                    <h4>✅ Excellent Generalization!</h4>
                    <p><strong>Training Accuracy:</strong> ${trainingPerformance.accuracy.toFixed(1)}%</p>
                    <p><strong>Test Accuracy:</strong> ${testPerformance.accuracy.toFixed(1)}%</p>
                    <p><strong>Difference:</strong> ${performanceDiff.toFixed(1)}%</p>
                    <p><strong>Conclusion:</strong> Your model generalizes very well! The small difference between training and test performance indicates the model learned the underlying pattern rather than just memorizing the training data.</p>
                `;
            } else if (performanceDiff < 10) {
                validationMessage = `
                    <h4>⚠️ Moderate Generalization</h4>
                    <p><strong>Training Accuracy:</strong> ${trainingPerformance.accuracy.toFixed(1)}%</p>
                    <p><strong>Test Accuracy:</strong> ${testPerformance.accuracy.toFixed(1)}%</p>
                    <p><strong>Difference:</strong> ${performanceDiff.toFixed(1)}%</p>
                    <p><strong>Conclusion:</strong> Your model shows some signs of overfitting but still generalizes reasonably well.</p>
                `;
            } else {
                validationMessage = `
                    <h4>❌ Poor Generalization</h4>
                    <p><strong>Training Accuracy:</strong> ${trainingPerformance.accuracy.toFixed(1)}%</p>
                    <p><strong>Test Accuracy:</strong> ${testPerformance.accuracy.toFixed(1)}%</p>
                    <p><strong>Difference:</strong> ${performanceDiff.toFixed(1)}%</p>
                    <p><strong>Conclusion:</strong> Your model may be overfitting to the training data.</p>
                `;
            }
            
            document.getElementById('validationText').innerHTML = validationMessage;
            document.getElementById('validationResults').style.display = 'block';
        }

        // Candy store analogy visualization
        function showCandyAnalogy() {
            console.log('Showing candy store analogy...');
            
            // Generate candy data
            const candySizes = [5, 8, 12, 15, 20, 25, 30, 35, 40, 45];
            const candyPrices = candySizes.map(size => 2 + size * 0.3 + (Math.random() - 0.5) * 1);
            
            const candyTrace = {
                x: candySizes,
                y: candyPrices,
                mode: 'markers',
                type: 'scatter',
                name: 'Candy Bags',
                marker: {
                    color: '#ff6b6b',
                    size: 12,
                    symbol: 'circle'
                }
            };
            
            // Add trend line
            const trendLine = {
                x: [5, 45],
                y: [3.5, 15.5],
                mode: 'lines',
                type: 'scatter',
                name: 'Pattern We Found',
                line: {
                    color: '#4CAF50',
                    width: 3
                }
            };
            
            const layout = {
                title: 'The Candy Store Pattern',
                xaxis: {title: 'Bag Size (ounces)', color: 'white'},
                yaxis: {title: 'Price ($)', color: 'white'},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)',
                font: {color: 'white'}
            };
            
            Plotly.newPlot('analogyPlot', [candyTrace, trendLine], layout);
        }

        // Show learning process
        function showLearningProcess() {
            document.getElementById('learningSteps').style.display = 'block';
        }

        // Show why it works
        function showWhyItWorks() {
            alert('This works because patterns exist in the world! Just like bigger candy bags usually cost more, bigger houses usually cost more. Machine learning helps us find and use these patterns to make predictions about new situations we haven\'t seen before.');
        }

        // Initialize
        window.onload = function() {
            console.log('Phase 4: Validation & Communication initialized');
        };
    </script>
</body>
</html>